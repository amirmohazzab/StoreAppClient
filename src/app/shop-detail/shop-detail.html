
<div class="product-detail-container">
  <!-- LEFT: PRODUCT GALLERY -->
  <div class="gallery">
    <img 
      class="main-img" 
      [src]="getImageUrl(selectedImage) || getImageUrl(product?.pictureUrl)"
      [alt]="product?.title"
      style="max-width: 150px;"
    >

   @if(product?.galleryImages){
     <div class="thumbnails">
      @for(img of product?.galleryImages; track $index){
        <img 
        [src]="img"
        (click)="selectedImage = img"
        [class.active]="selectedImage === img"
      >
      }
    </div>
   }
  </div>

  <!-- RIGHT: PRODUCT INFO -->
  <div class="info">
    <h1>{{ product?.title }}</h1>

    <div class="meta">
      <span class="brand">Brand: <b>{{ product?.productBrand }}</b></span>
      <span class="category">Category: <b>{{ product?.productType }}</b></span>
    </div>

    <div class="price-box">
      <span class="price">{{ product?.price | number }} Euro </span>
    </div>

    <p class="description">{{ product?.description }}</p>

    <div class="stats">
      @if(product){
        <span>
       <i [ngClass]="[product?.liked ? 'fas fa-heart' : 'far fa-heart', 'heart-animate']"></i>
        {{ product?.likeCount }}
      </span>
      }
      <span><i class="fa fa-eye"></i> {{ product?.viewCount }}</span>
    </div>

    <div class="actions">
      <input type="number" min="1" [(ngModel)]="quantity" class="qty-input">

      <button class="btn-cart" (click)="addToBasket()">
        <i class="fa fa-shopping-cart"></i> Add to Cart
      </button>

      <button 
        class="btn-like" 
        [class.active]="product?.liked"
        (click)="toggleLike(product)"
      >
        <!-- <i class="fa" [class.fa-heart]="product?.liked" [class.fa-heart-o]="!product?.liked"></i> -->
        <i [ngClass]="[product.liked ? 'fas fa-heart' : 'far fa-heart', 'heart-animate']"></i>
      </button>
    </div>

  </div>
</div>

<!-- TABS SECTION -->
<div class="tabs-section">

  <div class="tabs">
    <button (click)="activeTab='description'" [class.active]="activeTab==='description'">
      Description
    </button>
    <button (click)="activeTab='reviews'" [class.active]="activeTab==='reviews'">
      Reviews
    </button>
  </div>

  <div class="tab-content">
    @if(activeTab==='description'){
      <div>
      <p>{{ product?.description }}</p>
    </div>
    }

   @if(activeTab==='reviews'){
     <div>
      <!-- <h3>User Reviews</h3>
      <p *ngFor="let r of reviews">‚≠ê {{ r }}</p> -->
      <section class="reviews">
      
     <div class="d-flex align-items-center mb-2">
   @if(reviews){
     <h3 class="me-3">Customer Reviews ({{ reviews.result.length}})</h3>
   }
  <h4> Average Rating : <span class="ms-2">{{ averageRating.toFixed(2) }}</span> </h4>
  <div class="review-stars d-flex align-items-center">
    @for(star of getStars(); track $index){
      <span>
      <i 
        class="fa"
        [ngClass]="{
          'fa-star': isStarFilled(star, averageRating) === 'full',
          'fa-star-half-alt': isStarFilled(star, averageRating) === 'half',
          'fa-star-o': isStarFilled(star, averageRating) === 'empty'
        }"
      ></i>
    </span> 
    }
     
  </div>
</div>

  <!-- Review List -->
<div class="review-stars">

  @if(reviews.result.length === 0){
    <div>No reviews yet.</div>
  }

 @for(review of reviews.result; track $index){
   <div class="review-item mb-3">

  <p><strong>{{ review.userName }}</strong> - {{ review.created | date:'short' }}</p>

  <div class="review-stars d-flex align-items-center">
    @for(star of getStars(); track $index){
       <span>
      <i 
        class="fa"
        [ngClass]="{
          'fa-star': isStarFilled($index + 1, review.rating) === 'full',
          'fa-star-half-alt': isStarFilled($index + 1, review.rating) === 'half',
          'fa-star-o': isStarFilled($index + 1, review.rating) === 'empty'
        }"
      ></i>
    </span>
    }
    <span class="ms-2">{{ review.rating.toFixed(1) }}</span>
  </div>

  <p>{{ review.comment }}</p>

  </div>
 }

</div>

  <hr>

  <!-- Write Review -->
  <h4>Write a Review</h4>

  <form [formGroup]="reviewForm" (ngSubmit)="submitReview()">
    <div class="form-group">
      <label>Rating</label>
      <select class="form-control" formControlName="rating">
       @for(r of [1,2,3,4,5]; track $index){
         <option [value]="r">{{ r }}</option>
       }
      </select>
    </div>

    <div class="form-group mt-2">
      <label>Your Comment</label>
      <textarea class="form-control" rows="3" formControlName="comment"></textarea>
    </div>

    <button class="btn btn-primary mt-3" type="submit" [disabled]="reviewForm.invalid">
      Submit Review
    </button>
  </form>
      </section>

    </div>
   }
  </div>
</div>

<!-- RELATED PRODUCTS -->
<h3 class="related-title">Related Products</h3>

<div class="related-grid">
  @for(item of relatedProducts; track $index){
    <div class="item">
    <app-card-shop [product]="item"></app-card-shop>
  </div>
  }
</div>



